var y=Object.defineProperty;var E=(n,e,s)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var x=(n,e,s)=>(E(n,typeof e!="symbol"?e+"":e,s),s);import{e as v,r as u,R as d}from"./index-CcBoYM7q.js";import{r as w,aK as R,aL as q}from"./node/pnpm-BRmVptv7.js";class A{constructor(e){x(this,"axiosErrorFn",{401:()=>u.push({path:d.LOGIN}),"-402":()=>u.push({path:d.LOGIN}),403:()=>u.push({path:d.LOGIN}),404:()=>u.push({name:"404"}),500:()=>u.push({name:"500"}),501:()=>u.push({name:"network"}),502:()=>u.push({name:"network"}),503:()=>u.push({name:"building"}),504:()=>u.push({name:"network"})});this.config=e}init(){return this.requestApi.bind(this)}async requestApi({api:e,params:s,before:r,success:i,fail:a,error:f,complete:h,message:g=(o=>(o=this.config)==null?void 0:o.message)(),pushMessage:m=(l=>(l=this.config)==null?void 0:l.pushMessage)()}){try{const c=e(...s),t="cancel"in c?c.cancel:void 0;if(r&&await r(t)){t&&t();return}const p=await c;if(p){i&&i(p);return}if(!a||!await a(p))throw p}catch(c){if(f&&await f(c))return;this.handlerError(c,g,m)}finally{h&&h()}}handlerError(e,s,r){if(e&&typeof e=="object"){if("code"in e&&e.code==="ERR_CANCELED")return;let i,a=s;"extra"in e&&e.extra&&typeof e.extra=="object"&&"code"in e.extra&&typeof e.extra.code=="number"&&(i=this.axiosErrorFn[e.extra.code],"message"in e.extra&&typeof e.extra.message=="string"&&e.extra.message&&(a=e.extra.message),"msg"in e&&typeof e.msg=="string"&&e.msg&&(a=e.msg)),a&&r&&r(a),i&&i()}}}const b=new A({message:"加载失败",pushMessage(n){v.ElMessage.error({message:n,grouping:!0})}}),L=b.init();function I(n,e,{immediate:s=!0,message:r,success:i}={}){let a,f=e;const h=w(),g=w(),m=w(!1);async function o(){await L({api:n,params:f,before(t){a&&a(),m.value=!0,a=t},async success(t){h.value=t,i&&await i(t)},error(t){g.value=t},complete(){m.value=!1,a=void 0},message:r})}async function l(t,p=!0){f=t,p&&await o()}async function c(t=!0){f=e,t&&await o()}return s&&(R()?q(async()=>{await o()}):o()),{run:o,data:h,error:g,loading:m,setParams:l,reset:c}}export{I as u};
